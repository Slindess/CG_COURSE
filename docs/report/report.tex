\input{gost.tex}

\begin{document}

\chapter{Аналитическая часть}
\section{Алгоритмы удаления невидимых поверхностей или линий}
\subsection{Алгоритм Робертса}
Алгоритм Робертса работает в объектном пространстве. В первую очередь он удаляет те грани и линии, которые экранируются самим объектом. После чего, оставшиеся грани выпуклого многранника сравниваются с оставщимися гранями другого выпуклого многогранника. Если же многогранник не является выпуклым, то его придется разбивать на выпуклые, что приводит к дополнительным затратам. 

Для удаления невидимых объектов в контексте "горного ландшафта" он может оказаться крайне не эффективным, так как ландшафт состоит из невыпуклых объектов.

\subsection{Метод Z-Буффера} 
Метод Z-Буффера работает в пространстве изображений. В нем используется буффер для запоминания глубины каждого видимого пикселя. При обработке нового пикселя его глубина сравнивается с глубиной, записанной в буффере. Основной недостаток - потребление большого количества памяти. 

\subsection{Трассировка лучей}
Из положения камеры испускается луч через каждый пиксель изображения. Каждый луч проверяется на пересечение с объектом 3D сцены. В точке пересечения определяется освещенность поверхности по параметрам. Для рассчета теней испускаются тестовые лучи из точки пересечения к источникам света, если тестовый луч блокируют другие объекты сцены, то точка затеняется по выбранным алгоритмам. 

Для визуализации горного ландшафта, алгоритм трассировки лучей может стать самым оптимальным алгоритмом, так как он позволяет достичь высокого уровня реалистичности.

\section{Источники освещения}
\subsection{Точечный}
Точечный источник испускает свет, интенсивность которого уменьшается по мере отдаления от источника, во всех направлениях из точки.

\subsection{Направленный}
Равномерно освещает сцену в одном направлении, то есть сцена находится в однородном потоке света. Так как предполагается, что такой поток можно создать источником, удаленным на растояние, сильно превыщающем масштабы сцены, то его интенсивность не уменьшается. Примером такого источника является солнечный свет.

\subsection{Прожектор}
Прожектор создает направленный конус или усеченную пирамиду света. Сам свет становится более интенсивным по мере приближения к источнику и центру конуса.


\section{Отражение}
\subsection{Диффузное отражение}
Прямое освещение объекта равномерным количеством света, взаимодействующего с поверхностью. После того как свет падает на объект, он отражается в зависимости от свойств поверхности объекта, а также угла падения света. Свет, падающий перпендикулярно, создает более яркое освещение (Это явление описывается законом Ламберта). Матовые поверхности (дерево, камень, штукатурка) отражают больше диффузионного света, чем глянцевые, в результате чего они выглядят более мягкими.
При таком отражении положение наблюдателя не имеет значения, так как диффузно отраженный свет рассеивается равномерно по всем направлениям.

\subsection{Отражение окружающего света}
Окружающий свет не имеет направления. Его интенсивность определяется войствами материалов поверхностей объектов, а именно их коэффициентами отражения окружающего света.
Так же окружающий свет не отбрасывает тени и не имеет какого-то конкретного источника.
Окружающий свет действует на поверхности объектов независимо от их ориентации. Он добавляет базовый уровень освещенности, чтобы избежать полной темноты на теневых участках. Окружающий свет не требует сложных вычислений, таких как рассчет направления света.
 
\subsection{Зеркальное отражение}
Зеркальное отражение создает яркие пятна на объектах, исходя из интенсивности коэффициента зеркального отражения поверхности, а так же угла падения.
Каждый материал имеет свой коэффициент отражения.

\section{Модель освещения}
Модели освещения используются для визуализации световых эффектов, где все рассчеты воспроизводятся примерно на основе законов физики. Главной целью использования модели освещения является вычисления цвета каждого пикселя на основе его освещенности.

\subsection{Модель Фонга}
Модель Фонга является локальной моделью освещения, в которой освещенность пикселя определяется источниками света.
С помощью модели Фонга можно рассчитывать освещенность полигональных моделей.
Так как модель Фонга учитывает не только диффузионное отражение и отражение окружающего света, но и зеркальное отражение, то с ее помощью можно будет визуализировать блеск снежных горных вершин.
Модель Фонга учитывает положение зрителя для определения зеркального отражения.

\subsection{Глобальная модель освещения}
Глобальная модель освещения учитывает лучи, не только выпущенные из источника, но и отраженные лучи от других объектов. В результате получаются более реалистичные изображения, создание которых требует больших затрат.

\section{Технологии освещения}
\subsection{Карты освещения}
Карты освещения используется для предварительного расчета освещения. Подходит для статичных и не зеркальных объектов. На этапе подготовки сцены для каждого объекта рассчитывается вклад всех источников света. Значение освещенности в конкретной точке сохраняется, после чего накладывается на объекты. Предварительно посчитанное освещение избавляет от необходимости рассчитывать свет для каждого кадра.
Традиционно сцены ограничены локальной моделью освещения, так как глобальная требует высоких затрат. С помощью карты освещения можно провести вычисления в глобальной модели освещения один раз, что позволит достигнуть высого уровня реалистичности изображения, при снижении затрат.


\section{Сравнение алгоритмов удаления невидимых поверхностей и линий}
В таблице 1.1. представлены результаты сравнения алгоритмов удаления невидимых поверхностей и линий по различным параметрам. \\
$N$ - количество граней \\
$SIZE$ - количество пикселей на экране \\ 

\begin{table}[H]
	\begin{center}
        \small
		\caption{Сравнение алгоритмов}
		\label{tbl:comparing_algorithms}
		\begin{tabular}{
              |p{2.5in}| % Используем p вместо m для автоматического переноса
              >{\centering\arraybackslash}m{1in}|
              >{\centering\arraybackslash}m{1in}|
              >{\centering\arraybackslash}m{1.25in}|
              }
			 \hline
              & \textbf{Алгоритм Робертса} & \textbf{Метод Z-Буффера} & \textbf{Трассировка лучей} \\
             \hline
             Временная сложность & $O(N^2)$ & $O(SIZE \cdot N)$ & $O(SIZE \cdot N)$ \\
             \hline
             Подготовка данных & Разбиение на выпуклые объекты & $-$ & $-$ \\
             \hline
             Дополнительная Память & $-$ & $+$ & $-$ \\
             \hline
             Преимущества & Простота реализации & Эффективен для 3D сцен & Высокая реалистичность \\
             \hline
             Параллельные вычисления & $-$ & $-$ & $+$ \\ 
             \hline
		\end{tabular}
	\end{center}
\end{table}

\section{Генерация горного ландшафта}
\subsection{Шум Перлина}
Шум Перлина был предложен Кеном Перлином в 1983 году для генерации процедурных текстур и ландшафтов в компьютерной графике. Ландшафт выглядит естественным благодаря наличию в нем случайных элементов: выступов, неровностей. Шум Перлина добавляет эти случайные элементы в создаваемое изображение.

\subsubsection{Основная идея}
На генерируемой карте выбирается сетка, в узлах которой нужно сгенерировать векторы градиентов функции изменения высоты. Обычно все векторы имеют единичную длину и случайное направление:
\[
g(x_i) = \cos{\theta}
\]
\[
g(y_i) = \sin{\theta},
\]
где $\theta \in [0, 2\pi]$ — случайный угол.

В пределах каждого промежутка сетки выбираются точки $(x_p, y_p)$, для которых рассчитывается значение шума.

\subsubsection{Расчет смещения}
Для каждой точки внутри ячейки сетки вычисляется смещение относительно ближайших узлов:
\[
u = x_p - x_{\text{int}}, \quad v = y_p - y_{\text{int}},
\]
где $x_{\text{int}}$ и $y_{\text{int}}$ — целочисленные координаты ближайшего узла (например, левого верхнего), а $x_p$ и $y_p$ — координаты точки внутри ячейки, для которой вычисляется шум.

\subsubsection{Скалярное произведение}
Для каждой из четырех ближайших точек сетки рассчитывается скалярное произведение между градиентом узла и вектором смещения:
\[
\text{dot}(g, d) = g_x \cdot d_x + g_y \cdot d_y,
\]
где $g_x$ и $g_y$ — компоненты градиента узла, а $d_x$ и $d_y$ — компоненты вектора смещения до точки.

\subsubsection{Интерполяция значений}
Для получения итогового значения шума в точке используется линейная интерполяция. Сначала интерполируются значения по оси $x$:
\[
\text{lerp}(a, b, t) = a + t \cdot (b - a),
\]
где $a$ и $b$ — значения шума из двух ближайших узлов, а $t$ — дробная часть координаты, сглаженная функцией fade.

\subsubsection{Сглаживающая функция}
Для плавного перехода между точками применяется функция сглаживания (fade function):
\[
\text{fade}(t) = 6t^5 - 15t^4 + 10t^3.
\]
Эта функция позволяет избежать резких изменений значений шума между узлами сетки.

\imgscheme{wb_simple_perlin.png}{Шум перлина}

\imgscheme{wb_simple_perlin_z.png}{3D визуализация шума}

\subsection{Функции изменения высоты}
Для реалистичного построения ландшафта необходимо правильно формировать высоты 
при генерации Шума Перлина. \\
Для понимания формы вулканического склона рассмотрим процесс его формирования. 
В случае вулканических гор формирование происходит за счет извержения магмы и пепла. По мере того, как магма превращается в лаву, она начинает стекать вниз под действием силы тяжести. Лава начинает остывать и закрепляться на склоне. Поэтому ближе к вершине получается более крутой склон, нежели  внизу. В результате получаются конические или параболические структуры. Это хорошо видно на рисунке 1.3. \\
Для моделирования таких структур можно использовать следующие функции, описывающие изменения высоты:
\[
h = 1 - (\frac{D}{R})^2,
\] где $D$ - расстояние до вершины, $R$ - радиус основания горы.
\imgscheme{mount.jpeg}{Вулканический склон}

\end{document}

